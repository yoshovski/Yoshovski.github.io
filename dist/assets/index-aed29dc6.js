import{E as bn,V as C,M as ae,T as ce,Q as Oe,S as bt,a as N,b as En,c as Xe,d as Nt,L as tt,e as qe,F as Te,C as J,f as An,P as ne,D as wn,g as ee,s as ue,h as se,I as xn,O as Ct,i as nt,j as Ln,B as me,k as Rn,l as Dt,m as kt,R as Ye,n as _n,o as Ge,p as Sn,q as Ie,r as Mn,t as On,u as Ft,v as In,w as Pe,x as Pn,y as Nn,z as Cn,A as Dn,G as Be,H as Ht,J as kn,K as Fn,N as Hn,U as jt,W as vt,X as jn,Y as Ne,Z as Ze,_ as vn,$ as Un,a0 as Gn,a1 as Bn,a2 as Kn,a3 as zn,a4 as Vn,a5 as Wn,a6 as Et,a7 as Xn,a8 as At,a9 as qn,aa as Yn,ab as Zn,ac as Qn,ad as Jn,ae as $n,af as es,ag as ts,ah as ns,ai as ss,aj as os,ak as Ae,al as E,am as is,an as Ut,ao as rs,ap as as,aq as cs,ar as ls}from"./vendor-4c1c5ad7.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&e(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const wt={type:"change"},Ke={type:"start"},xt={type:"end"};class us extends bn{constructor(t,n){super(),this.object=t,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new C,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ae.ROTATE,MIDDLE:ae.DOLLY,RIGHT:ae.PAN},this.touches={ONE:ce.ROTATE,TWO:ce.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return r.phi},this.getAzimuthalAngle=function(){return r.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(d){d.addEventListener("keydown",pt),this._domElementKeyEvents=d},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(wt),e.update(),o=s.NONE},this.update=function(){const d=new C,b=new Oe().setFromUnitVectors(t.up,new C(0,1,0)),S=b.clone().invert(),O=new C,B=new Oe,re=2*Math.PI;return function(){const yt=e.object.position;d.copy(yt).sub(e.target),d.applyQuaternion(b),r.setFromVector3(d),e.autoRotate&&o===s.NONE&&j(P()),e.enableDamping?(r.theta+=a.theta*e.dampingFactor,r.phi+=a.phi*e.dampingFactor):(r.theta+=a.theta,r.phi+=a.phi);let V=e.minAzimuthAngle,W=e.maxAzimuthAngle;return isFinite(V)&&isFinite(W)&&(V<-Math.PI?V+=re:V>Math.PI&&(V-=re),W<-Math.PI?W+=re:W>Math.PI&&(W-=re),V<=W?r.theta=Math.max(V,Math.min(W,r.theta)):r.theta=r.theta>(V+W)/2?Math.max(V,r.theta):Math.min(W,r.theta)),r.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,r.phi)),r.makeSafe(),r.radius*=l,r.radius=Math.max(e.minDistance,Math.min(e.maxDistance,r.radius)),e.enableDamping===!0?e.target.addScaledVector(h,e.dampingFactor):e.target.add(h),d.setFromSpherical(r),d.applyQuaternion(S),yt.copy(e.target).add(d),e.object.lookAt(e.target),e.enableDamping===!0?(a.theta*=1-e.dampingFactor,a.phi*=1-e.dampingFactor,h.multiplyScalar(1-e.dampingFactor)):(a.set(0,0,0),h.set(0,0,0)),l=1,u||O.distanceToSquared(e.object.position)>i||8*(1-B.dot(e.object.quaternion))>i?(e.dispatchEvent(wt),O.copy(e.object.position),B.copy(e.object.quaternion),u=!1,!0):!1}}(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",mt),e.domElement.removeEventListener("pointerdown",dt),e.domElement.removeEventListener("pointercancel",ft),e.domElement.removeEventListener("wheel",ht),e.domElement.removeEventListener("pointermove",je),e.domElement.removeEventListener("pointerup",ve),e._domElementKeyEvents!==null&&e._domElementKeyEvents.removeEventListener("keydown",pt)};const e=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=s.NONE;const i=1e-6,r=new bt,a=new bt;let l=1;const h=new C;let u=!1;const f=new N,p=new N,T=new N,g=new N,m=new N,y=new N,L=new N,w=new N,R=new N,A=[],I={};function P(){return 2*Math.PI/60/60*e.autoRotateSpeed}function k(){return Math.pow(.95,e.zoomSpeed)}function j(d){a.theta-=d}function ie(d){a.phi-=d}const $=function(){const d=new C;return function(S,O){d.setFromMatrixColumn(O,0),d.multiplyScalar(-S),h.add(d)}}(),z=function(){const d=new C;return function(S,O){e.screenSpacePanning===!0?d.setFromMatrixColumn(O,1):(d.setFromMatrixColumn(O,0),d.crossVectors(e.object.up,d)),d.multiplyScalar(S),h.add(d)}}(),M=function(){const d=new C;return function(S,O){const B=e.domElement;if(e.object.isPerspectiveCamera){const re=e.object.position;d.copy(re).sub(e.target);let Ee=d.length();Ee*=Math.tan(e.object.fov/2*Math.PI/180),$(2*S*Ee/B.clientHeight,e.object.matrix),z(2*O*Ee/B.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?($(S*(e.object.right-e.object.left)/e.object.zoom/B.clientWidth,e.object.matrix),z(O*(e.object.top-e.object.bottom)/e.object.zoom/B.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}}();function X(d){e.object.isPerspectiveCamera?l/=d:e.object.isOrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom*d)),e.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function G(d){e.object.isPerspectiveCamera?l*=d:e.object.isOrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/d)),e.object.updateProjectionMatrix(),u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function de(d){f.set(d.clientX,d.clientY)}function He(d){L.set(d.clientX,d.clientY)}function be(d){g.set(d.clientX,d.clientY)}function on(d){p.set(d.clientX,d.clientY),T.subVectors(p,f).multiplyScalar(e.rotateSpeed);const b=e.domElement;j(2*Math.PI*T.x/b.clientHeight),ie(2*Math.PI*T.y/b.clientHeight),f.copy(p),e.update()}function rn(d){w.set(d.clientX,d.clientY),R.subVectors(w,L),R.y>0?X(k()):R.y<0&&G(k()),L.copy(w),e.update()}function an(d){m.set(d.clientX,d.clientY),y.subVectors(m,g).multiplyScalar(e.panSpeed),M(y.x,y.y),g.copy(m),e.update()}function cn(d){d.deltaY<0?G(k()):d.deltaY>0&&X(k()),e.update()}function ln(d){let b=!1;switch(d.code){case e.keys.UP:d.ctrlKey||d.metaKey||d.shiftKey?ie(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):M(0,e.keyPanSpeed),b=!0;break;case e.keys.BOTTOM:d.ctrlKey||d.metaKey||d.shiftKey?ie(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):M(0,-e.keyPanSpeed),b=!0;break;case e.keys.LEFT:d.ctrlKey||d.metaKey||d.shiftKey?j(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):M(e.keyPanSpeed,0),b=!0;break;case e.keys.RIGHT:d.ctrlKey||d.metaKey||d.shiftKey?j(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):M(-e.keyPanSpeed,0),b=!0;break}b&&(d.preventDefault(),e.update())}function it(){if(A.length===1)f.set(A[0].pageX,A[0].pageY);else{const d=.5*(A[0].pageX+A[1].pageX),b=.5*(A[0].pageY+A[1].pageY);f.set(d,b)}}function rt(){if(A.length===1)g.set(A[0].pageX,A[0].pageY);else{const d=.5*(A[0].pageX+A[1].pageX),b=.5*(A[0].pageY+A[1].pageY);g.set(d,b)}}function at(){const d=A[0].pageX-A[1].pageX,b=A[0].pageY-A[1].pageY,S=Math.sqrt(d*d+b*b);L.set(0,S)}function un(){e.enableZoom&&at(),e.enablePan&&rt()}function dn(){e.enableZoom&&at(),e.enableRotate&&it()}function ct(d){if(A.length==1)p.set(d.pageX,d.pageY);else{const S=Ue(d),O=.5*(d.pageX+S.x),B=.5*(d.pageY+S.y);p.set(O,B)}T.subVectors(p,f).multiplyScalar(e.rotateSpeed);const b=e.domElement;j(2*Math.PI*T.x/b.clientHeight),ie(2*Math.PI*T.y/b.clientHeight),f.copy(p)}function lt(d){if(A.length===1)m.set(d.pageX,d.pageY);else{const b=Ue(d),S=.5*(d.pageX+b.x),O=.5*(d.pageY+b.y);m.set(S,O)}y.subVectors(m,g).multiplyScalar(e.panSpeed),M(y.x,y.y),g.copy(m)}function ut(d){const b=Ue(d),S=d.pageX-b.x,O=d.pageY-b.y,B=Math.sqrt(S*S+O*O);w.set(0,B),R.set(0,Math.pow(w.y/L.y,e.zoomSpeed)),X(R.y),L.copy(w)}function fn(d){e.enableZoom&&ut(d),e.enablePan&&lt(d)}function hn(d){e.enableZoom&&ut(d),e.enableRotate&&ct(d)}function dt(d){e.enabled!==!1&&(A.length===0&&(e.domElement.setPointerCapture(d.pointerId),e.domElement.addEventListener("pointermove",je),e.domElement.addEventListener("pointerup",ve)),yn(d),d.pointerType==="touch"?gn(d):pn(d))}function je(d){e.enabled!==!1&&(d.pointerType==="touch"?Tn(d):mn(d))}function ve(d){gt(d),A.length===0&&(e.domElement.releasePointerCapture(d.pointerId),e.domElement.removeEventListener("pointermove",je),e.domElement.removeEventListener("pointerup",ve)),e.dispatchEvent(xt),o=s.NONE}function ft(d){gt(d)}function pn(d){let b;switch(d.button){case 0:b=e.mouseButtons.LEFT;break;case 1:b=e.mouseButtons.MIDDLE;break;case 2:b=e.mouseButtons.RIGHT;break;default:b=-1}switch(b){case ae.DOLLY:if(e.enableZoom===!1)return;He(d),o=s.DOLLY;break;case ae.ROTATE:if(d.ctrlKey||d.metaKey||d.shiftKey){if(e.enablePan===!1)return;be(d),o=s.PAN}else{if(e.enableRotate===!1)return;de(d),o=s.ROTATE}break;case ae.PAN:if(d.ctrlKey||d.metaKey||d.shiftKey){if(e.enableRotate===!1)return;de(d),o=s.ROTATE}else{if(e.enablePan===!1)return;be(d),o=s.PAN}break;default:o=s.NONE}o!==s.NONE&&e.dispatchEvent(Ke)}function mn(d){switch(o){case s.ROTATE:if(e.enableRotate===!1)return;on(d);break;case s.DOLLY:if(e.enableZoom===!1)return;rn(d);break;case s.PAN:if(e.enablePan===!1)return;an(d);break}}function ht(d){e.enabled===!1||e.enableZoom===!1||o!==s.NONE||(d.preventDefault(),e.dispatchEvent(Ke),cn(d),e.dispatchEvent(xt))}function pt(d){e.enabled===!1||e.enablePan===!1||ln(d)}function gn(d){switch(Tt(d),A.length){case 1:switch(e.touches.ONE){case ce.ROTATE:if(e.enableRotate===!1)return;it(),o=s.TOUCH_ROTATE;break;case ce.PAN:if(e.enablePan===!1)return;rt(),o=s.TOUCH_PAN;break;default:o=s.NONE}break;case 2:switch(e.touches.TWO){case ce.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;un(),o=s.TOUCH_DOLLY_PAN;break;case ce.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;dn(),o=s.TOUCH_DOLLY_ROTATE;break;default:o=s.NONE}break;default:o=s.NONE}o!==s.NONE&&e.dispatchEvent(Ke)}function Tn(d){switch(Tt(d),o){case s.TOUCH_ROTATE:if(e.enableRotate===!1)return;ct(d),e.update();break;case s.TOUCH_PAN:if(e.enablePan===!1)return;lt(d),e.update();break;case s.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;fn(d),e.update();break;case s.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;hn(d),e.update();break;default:o=s.NONE}}function mt(d){e.enabled!==!1&&d.preventDefault()}function yn(d){A.push(d)}function gt(d){delete I[d.pointerId];for(let b=0;b<A.length;b++)if(A[b].pointerId==d.pointerId){A.splice(b,1);return}}function Tt(d){let b=I[d.pointerId];b===void 0&&(b=new N,I[d.pointerId]=b),b.set(d.pageX,d.pageY)}function Ue(d){const b=d.pointerId===A[0].pointerId?A[1]:A[0];return I[b.pointerId]}e.domElement.addEventListener("contextmenu",mt),e.domElement.addEventListener("pointerdown",dt),e.domElement.addEventListener("pointercancel",ft),e.domElement.addEventListener("wheel",ht,{passive:!1}),this.update()}}function Lt(c,t){if(t===En)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),c;if(t===Xe||t===Nt){let n=c.getIndex();if(n===null){const i=[],r=c.getAttribute("position");if(r!==void 0){for(let a=0;a<r.count;a++)i.push(a);c.setIndex(i),n=c.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),c}const e=n.count-2,s=[];if(t===Xe)for(let i=1;i<=e;i++)s.push(n.getX(0)),s.push(n.getX(i)),s.push(n.getX(i+1));else for(let i=0;i<e;i++)i%2===0?(s.push(n.getX(i)),s.push(n.getX(i+1)),s.push(n.getX(i+2))):(s.push(n.getX(i+2)),s.push(n.getX(i+1)),s.push(n.getX(i)));s.length/3!==e&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=c.clone();return o.setIndex(s),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),c}class ds extends tt{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new gs(n)}),this.register(function(n){return new xs(n)}),this.register(function(n){return new Ls(n)}),this.register(function(n){return new ys(n)}),this.register(function(n){return new bs(n)}),this.register(function(n){return new Es(n)}),this.register(function(n){return new As(n)}),this.register(function(n){return new ms(n)}),this.register(function(n){return new ws(n)}),this.register(function(n){return new Ts(n)}),this.register(function(n){return new hs(n)}),this.register(function(n){return new Rs(n)}),this.register(function(n){return new _s(n)})}load(t,n,e,s){const o=this;let i;this.resourcePath!==""?i=this.resourcePath:this.path!==""?i=this.path:i=qe.extractUrlBase(t),this.manager.itemStart(t);const r=function(l){s?s(l):console.error(l),o.manager.itemError(t),o.manager.itemEnd(t)},a=new Te(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(l){try{o.parse(l,i,function(h){n(h),o.manager.itemEnd(t)},r)}catch(h){r(h)}},e,r)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,n,e,s){let o;const i={},r={},a=new TextDecoder;if(typeof t=="string")o=JSON.parse(t);else if(t instanceof ArrayBuffer)if(a.decode(new Uint8Array(t,0,4))===Gt){try{i[x.KHR_BINARY_GLTF]=new Ss(t)}catch(u){s&&s(u);return}o=JSON.parse(i[x.KHR_BINARY_GLTF].content)}else o=JSON.parse(a.decode(t));else o=t;if(o.asset===void 0||o.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new Us(o,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const u=this.pluginCallbacks[h](l);r[u.name]=u,i[u.name]=!0}if(o.extensionsUsed)for(let h=0;h<o.extensionsUsed.length;++h){const u=o.extensionsUsed[h],f=o.extensionsRequired||[];switch(u){case x.KHR_MATERIALS_UNLIT:i[u]=new ps;break;case x.KHR_DRACO_MESH_COMPRESSION:i[u]=new Ms(o,this.dracoLoader);break;case x.KHR_TEXTURE_TRANSFORM:i[u]=new Os;break;case x.KHR_MESH_QUANTIZATION:i[u]=new Is;break;default:f.indexOf(u)>=0&&r[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(i),l.setPlugins(r),l.parse(e,s)}parseAsync(t,n){const e=this;return new Promise(function(s,o){e.parse(t,n,s,o)})}}function fs(){let c={};return{get:function(t){return c[t]},add:function(t,n){c[t]=n},remove:function(t){delete c[t]},removeAll:function(){c={}}}}const x={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class hs{constructor(t){this.parser=t,this.name=x.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,n=this.parser.json.nodes||[];for(let e=0,s=n.length;e<s;e++){const o=n[e];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(t){const n=this.parser,e="light:"+t;let s=n.cache.get(e);if(s)return s;const o=n.json,a=((o.extensions&&o.extensions[this.name]||{}).lights||[])[t];let l;const h=new J(16777215);a.color!==void 0&&h.fromArray(a.color);const u=a.range!==void 0?a.range:0;switch(a.type){case"directional":l=new wn(h),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new ne(h),l.distance=u;break;case"spot":l=new An(h),l.distance=u,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,l.angle=a.spot.outerConeAngle,l.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return l.position.set(0,0,0),l.decay=2,Y(l,a),a.intensity!==void 0&&(l.intensity=a.intensity),l.name=n.createUniqueName(a.name||"light_"+t),s=Promise.resolve(l),n.cache.add(e,s),s}getDependency(t,n){if(t==="light")return this._loadLight(n)}createNodeAttachment(t){const n=this,e=this.parser,o=e.json.nodes[t],r=(o.extensions&&o.extensions[this.name]||{}).light;return r===void 0?null:this._loadLight(r).then(function(a){return e._getNodeRef(n.cache,r,a)})}}class ps{constructor(){this.name=x.KHR_MATERIALS_UNLIT}getMaterialType(){return ee}extendParams(t,n,e){const s=[];t.color=new J(1,1,1),t.opacity=1;const o=n.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const i=o.baseColorFactor;t.color.fromArray(i),t.opacity=i[3]}o.baseColorTexture!==void 0&&s.push(e.assignTexture(t,"map",o.baseColorTexture,ue))}return Promise.all(s)}}class ms{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,n){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name].emissiveStrength;return o!==void 0&&(n.emissiveIntensity=o),Promise.resolve()}}class gs{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:se}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],i=s.extensions[this.name];if(i.clearcoatFactor!==void 0&&(n.clearcoat=i.clearcoatFactor),i.clearcoatTexture!==void 0&&o.push(e.assignTexture(n,"clearcoatMap",i.clearcoatTexture)),i.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=i.clearcoatRoughnessFactor),i.clearcoatRoughnessTexture!==void 0&&o.push(e.assignTexture(n,"clearcoatRoughnessMap",i.clearcoatRoughnessTexture)),i.clearcoatNormalTexture!==void 0&&(o.push(e.assignTexture(n,"clearcoatNormalMap",i.clearcoatNormalTexture)),i.clearcoatNormalTexture.scale!==void 0)){const r=i.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new N(r,r)}return Promise.all(o)}}class Ts{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:se}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],i=s.extensions[this.name];return i.iridescenceFactor!==void 0&&(n.iridescence=i.iridescenceFactor),i.iridescenceTexture!==void 0&&o.push(e.assignTexture(n,"iridescenceMap",i.iridescenceTexture)),i.iridescenceIor!==void 0&&(n.iridescenceIOR=i.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),i.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=i.iridescenceThicknessMinimum),i.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=i.iridescenceThicknessMaximum),i.iridescenceThicknessTexture!==void 0&&o.push(e.assignTexture(n,"iridescenceThicknessMap",i.iridescenceThicknessTexture)),Promise.all(o)}}class ys{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_SHEEN}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:se}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[];n.sheenColor=new J(0,0,0),n.sheenRoughness=0,n.sheen=1;const i=s.extensions[this.name];return i.sheenColorFactor!==void 0&&n.sheenColor.fromArray(i.sheenColorFactor),i.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=i.sheenRoughnessFactor),i.sheenColorTexture!==void 0&&o.push(e.assignTexture(n,"sheenColorMap",i.sheenColorTexture,ue)),i.sheenRoughnessTexture!==void 0&&o.push(e.assignTexture(n,"sheenRoughnessMap",i.sheenRoughnessTexture)),Promise.all(o)}}class bs{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:se}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],i=s.extensions[this.name];return i.transmissionFactor!==void 0&&(n.transmission=i.transmissionFactor),i.transmissionTexture!==void 0&&o.push(e.assignTexture(n,"transmissionMap",i.transmissionTexture)),Promise.all(o)}}class Es{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_VOLUME}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:se}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],i=s.extensions[this.name];n.thickness=i.thicknessFactor!==void 0?i.thicknessFactor:0,i.thicknessTexture!==void 0&&o.push(e.assignTexture(n,"thicknessMap",i.thicknessTexture)),n.attenuationDistance=i.attenuationDistance||1/0;const r=i.attenuationColor||[1,1,1];return n.attenuationColor=new J(r[0],r[1],r[2]),Promise.all(o)}}class As{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_IOR}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:se}extendMaterialParams(t,n){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];return n.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}}class ws{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_SPECULAR}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:se}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],i=s.extensions[this.name];n.specularIntensity=i.specularFactor!==void 0?i.specularFactor:1,i.specularTexture!==void 0&&o.push(e.assignTexture(n,"specularIntensityMap",i.specularTexture));const r=i.specularColorFactor||[1,1,1];return n.specularColor=new J(r[0],r[1],r[2]),i.specularColorTexture!==void 0&&o.push(e.assignTexture(n,"specularColorMap",i.specularColorTexture,ue)),Promise.all(o)}}class xs{constructor(t){this.parser=t,this.name=x.KHR_TEXTURE_BASISU}loadTexture(t){const n=this.parser,e=n.json,s=e.textures[t];if(!s.extensions||!s.extensions[this.name])return null;const o=s.extensions[this.name],i=n.options.ktx2Loader;if(!i){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(t,o.source,i)}}class Ls{constructor(t){this.parser=t,this.name=x.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const n=this.name,e=this.parser,s=e.json,o=s.textures[t];if(!o.extensions||!o.extensions[n])return null;const i=o.extensions[n],r=s.images[i.source];let a=e.textureLoader;if(r.uri){const l=e.options.manager.getHandler(r.uri);l!==null&&(a=l)}return this.detectSupport().then(function(l){if(l)return e.loadTextureImage(t,i.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return e.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){t(n.height===1)}})),this.isSupported}}class Rs{constructor(t){this.name=x.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const n=this.parser.json,e=n.bufferViews[t];if(e.extensions&&e.extensions[this.name]){const s=e.extensions[this.name],o=this.parser.getDependency("buffer",s.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(r){const a=s.byteOffset||0,l=s.byteLength||0,h=s.count,u=s.byteStride,f=new Uint8Array(r,a,l);return i.decodeGltfBufferAsync?i.decodeGltfBufferAsync(h,u,f,s.mode,s.filter).then(function(p){return p.buffer}):i.ready.then(function(){const p=new ArrayBuffer(h*u);return i.decodeGltfBuffer(new Uint8Array(p),h,u,f,s.mode,s.filter),p})})}else return null}}class _s{constructor(t){this.name=x.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const n=this.parser.json,e=n.nodes[t];if(!e.extensions||!e.extensions[this.name]||e.mesh===void 0)return null;const s=n.meshes[e.mesh];for(const l of s.primitives)if(l.mode!==v.TRIANGLES&&l.mode!==v.TRIANGLE_STRIP&&l.mode!==v.TRIANGLE_FAN&&l.mode!==void 0)return null;const i=e.extensions[this.name].attributes,r=[],a={};for(const l in i)r.push(this.parser.getDependency("accessor",i[l]).then(h=>(a[l]=h,a[l])));return r.length<1?null:(r.push(this.parser.createNodeMesh(t)),Promise.all(r).then(l=>{const h=l.pop(),u=h.isGroup?h.children:[h],f=l[0].count,p=[];for(const T of u){const g=new Ne,m=new C,y=new Oe,L=new C(1,1,1),w=new xn(T.geometry,T.material,f);for(let R=0;R<f;R++)a.TRANSLATION&&m.fromBufferAttribute(a.TRANSLATION,R),a.ROTATION&&y.fromBufferAttribute(a.ROTATION,R),a.SCALE&&L.fromBufferAttribute(a.SCALE,R),w.setMatrixAt(R,g.compose(m,y,L));for(const R in a)R!=="TRANSLATION"&&R!=="ROTATION"&&R!=="SCALE"&&T.geometry.setAttribute(R,a[R]);Ct.prototype.copy.call(w,T),w.frustumCulled=!1,this.parser.assignFinalMaterial(w),p.push(w)}return h.isGroup?(h.clear(),h.add(...p),h):p[0]}))}}const Gt="glTF",fe=12,Rt={JSON:1313821514,BIN:5130562};class Ss{constructor(t){this.name=x.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(t,0,fe),e=new TextDecoder;if(this.header={magic:e.decode(new Uint8Array(t.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==Gt)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-fe,o=new DataView(t,fe);let i=0;for(;i<s;){const r=o.getUint32(i,!0);i+=4;const a=o.getUint32(i,!0);if(i+=4,a===Rt.JSON){const l=new Uint8Array(t,fe+i,r);this.content=e.decode(l)}else if(a===Rt.BIN){const l=fe+i;this.body=t.slice(l,l+r)}i+=r}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ms{constructor(t,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=x.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(t,n){const e=this.json,s=this.dracoLoader,o=t.extensions[this.name].bufferView,i=t.extensions[this.name].attributes,r={},a={},l={};for(const h in i){const u=Qe[h]||h.toLowerCase();r[u]=i[h]}for(const h in t.attributes){const u=Qe[h]||h.toLowerCase();if(i[h]!==void 0){const f=e.accessors[t.attributes[h]],p=le[f.componentType];l[u]=p.name,a[u]=f.normalized===!0}}return n.getDependency("bufferView",o).then(function(h){return new Promise(function(u){s.decodeDracoFile(h,function(f){for(const p in f.attributes){const T=f.attributes[p],g=a[p];g!==void 0&&(T.normalized=g)}u(f)},r,l)})})}}class Os{constructor(){this.name=x.KHR_TEXTURE_TRANSFORM}extendTexture(t,n){return n.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(t=t.clone(),n.offset!==void 0&&t.offset.fromArray(n.offset),n.rotation!==void 0&&(t.rotation=n.rotation),n.scale!==void 0&&t.repeat.fromArray(n.scale),t.needsUpdate=!0),t}}class Is{constructor(){this.name=x.KHR_MESH_QUANTIZATION}}class Bt extends Qn{constructor(t,n,e,s){super(t,n,e,s)}copySampleValue_(t){const n=this.resultBuffer,e=this.sampleValues,s=this.valueSize,o=t*s*3+s;for(let i=0;i!==s;i++)n[i]=e[o+i];return n}interpolate_(t,n,e,s){const o=this.resultBuffer,i=this.sampleValues,r=this.valueSize,a=r*2,l=r*3,h=s-n,u=(e-n)/h,f=u*u,p=f*u,T=t*l,g=T-l,m=-2*p+3*f,y=p-f,L=1-m,w=y-f+u;for(let R=0;R!==r;R++){const A=i[g+R+r],I=i[g+R+a]*h,P=i[T+R+r],k=i[T+R]*h;o[R]=L*A+w*I+m*P+y*k}return o}}const Ps=new Oe;class Ns extends Bt{interpolate_(t,n,e,s){const o=super.interpolate_(t,n,e,s);return Ps.fromArray(o).normalize().toArray(o),o}}const v={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},le={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},_t={9728:Ze,9729:Dt,9984:vn,9985:Un,9986:Gn,9987:kt},St={33071:Bn,33648:Kn,10497:Ye},ze={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Qe={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},q={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Cs={CUBICSPLINE:void 0,LINEAR:jt,STEP:zn},Ve={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Ds(c){return c.DefaultMaterial===void 0&&(c.DefaultMaterial=new Ie({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Vn})),c.DefaultMaterial}function he(c,t,n){for(const e in n.extensions)c[e]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[e]=n.extensions[e])}function Y(c,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(c.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function ks(c,t,n){let e=!1,s=!1,o=!1;for(let l=0,h=t.length;l<h;l++){const u=t[l];if(u.POSITION!==void 0&&(e=!0),u.NORMAL!==void 0&&(s=!0),u.COLOR_0!==void 0&&(o=!0),e&&s&&o)break}if(!e&&!s&&!o)return Promise.resolve(c);const i=[],r=[],a=[];for(let l=0,h=t.length;l<h;l++){const u=t[l];if(e){const f=u.POSITION!==void 0?n.getDependency("accessor",u.POSITION):c.attributes.position;i.push(f)}if(s){const f=u.NORMAL!==void 0?n.getDependency("accessor",u.NORMAL):c.attributes.normal;r.push(f)}if(o){const f=u.COLOR_0!==void 0?n.getDependency("accessor",u.COLOR_0):c.attributes.color;a.push(f)}}return Promise.all([Promise.all(i),Promise.all(r),Promise.all(a)]).then(function(l){const h=l[0],u=l[1],f=l[2];return e&&(c.morphAttributes.position=h),s&&(c.morphAttributes.normal=u),o&&(c.morphAttributes.color=f),c.morphTargetsRelative=!0,c})}function Fs(c,t){if(c.updateMorphTargets(),t.weights!==void 0)for(let n=0,e=t.weights.length;n<e;n++)c.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(c.morphTargetInfluences.length===n.length){c.morphTargetDictionary={};for(let e=0,s=n.length;e<s;e++)c.morphTargetDictionary[n[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Hs(c){const t=c.extensions&&c.extensions[x.KHR_DRACO_MESH_COMPRESSION];let n;return t?n="draco:"+t.bufferView+":"+t.indices+":"+Mt(t.attributes):n=c.indices+":"+Mt(c.attributes)+":"+c.mode,n}function Mt(c){let t="";const n=Object.keys(c).sort();for(let e=0,s=n.length;e<s;e++)t+=n[e]+":"+c[n[e]]+";";return t}function Je(c){switch(c){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function js(c){return c.search(/\.jpe?g($|\?)/i)>0||c.search(/^data\:image\/jpeg/)===0?"image/jpeg":c.search(/\.webp($|\?)/i)>0||c.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const vs=new Ne;class Us{constructor(t={},n={}){this.json=t,this.extensions={},this.plugins={},this.options=n,this.cache=new fs,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let e=!1,s=!1,o=-1;typeof navigator<"u"&&(e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,o=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||e||s&&o<98?this.textureLoader=new nt(this.options.manager):this.textureLoader=new Ln(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Te(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,n){const e=this,s=this.json,o=this.extensions;this.cache.removeAll(),this._invokeAll(function(i){return i._markDefs&&i._markDefs()}),Promise.all(this._invokeAll(function(i){return i.beforeRoot&&i.beforeRoot()})).then(function(){return Promise.all([e.getDependencies("scene"),e.getDependencies("animation"),e.getDependencies("camera")])}).then(function(i){const r={scene:i[0][s.scene||0],scenes:i[0],animations:i[1],cameras:i[2],asset:s.asset,parser:e,userData:{}};he(o,r,s),Y(r,s),Promise.all(e._invokeAll(function(a){return a.afterRoot&&a.afterRoot(r)})).then(function(){t(r)})}).catch(n)}_markDefs(){const t=this.json.nodes||[],n=this.json.skins||[],e=this.json.meshes||[];for(let s=0,o=n.length;s<o;s++){const i=n[s].joints;for(let r=0,a=i.length;r<a;r++)t[i[r]].isBone=!0}for(let s=0,o=t.length;s<o;s++){const i=t[s];i.mesh!==void 0&&(this._addNodeRef(this.meshCache,i.mesh),i.skin!==void 0&&(e[i.mesh].isSkinnedMesh=!0)),i.camera!==void 0&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(t,n){n!==void 0&&(t.refs[n]===void 0&&(t.refs[n]=t.uses[n]=0),t.refs[n]++)}_getNodeRef(t,n,e){if(t.refs[n]<=1)return e;const s=e.clone(),o=(i,r)=>{const a=this.associations.get(i);a!=null&&this.associations.set(r,a);for(const[l,h]of i.children.entries())o(h,r.children[l])};return o(e,s),s.name+="_instance_"+t.uses[n]++,s}_invokeOne(t){const n=Object.values(this.plugins);n.push(this);for(let e=0;e<n.length;e++){const s=t(n[e]);if(s)return s}return null}_invokeAll(t){const n=Object.values(this.plugins);n.unshift(this);const e=[];for(let s=0;s<n.length;s++){const o=t(n[s]);o&&e.push(o)}return e}getDependency(t,n){const e=t+":"+n;let s=this.cache.get(e);if(!s){switch(t){case"scene":s=this.loadScene(n);break;case"node":s=this._invokeOne(function(o){return o.loadNode&&o.loadNode(n)});break;case"mesh":s=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(n)});break;case"accessor":s=this.loadAccessor(n);break;case"bufferView":s=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(n)});break;case"buffer":s=this.loadBuffer(n);break;case"material":s=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(n)});break;case"texture":s=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(n)});break;case"skin":s=this.loadSkin(n);break;case"animation":s=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(n)});break;case"camera":s=this.loadCamera(n);break;default:if(s=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(t,n)}),!s)throw new Error("Unknown type: "+t);break}this.cache.add(e,s)}return s}getDependencies(t){let n=this.cache.get(t);if(!n){const e=this,s=this.json[t+(t==="mesh"?"es":"s")]||[];n=Promise.all(s.map(function(o,i){return e.getDependency(t,i)})),this.cache.add(t,n)}return n}loadBuffer(t){const n=this.json.buffers[t],e=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&t===0)return Promise.resolve(this.extensions[x.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(o,i){e.load(qe.resolveURL(n.uri,s.path),o,void 0,function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(t){const n=this.json.bufferViews[t];return this.getDependency("buffer",n.buffer).then(function(e){const s=n.byteLength||0,o=n.byteOffset||0;return e.slice(o,o+s)})}loadAccessor(t){const n=this,e=this.json,s=this.json.accessors[t];if(s.bufferView===void 0&&s.sparse===void 0){const i=ze[s.type],r=le[s.componentType],a=s.normalized===!0,l=new r(s.count*i);return Promise.resolve(new me(l,i,a))}const o=[];return s.bufferView!==void 0?o.push(this.getDependency("bufferView",s.bufferView)):o.push(null),s.sparse!==void 0&&(o.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(o).then(function(i){const r=i[0],a=ze[s.type],l=le[s.componentType],h=l.BYTES_PER_ELEMENT,u=h*a,f=s.byteOffset||0,p=s.bufferView!==void 0?e.bufferViews[s.bufferView].byteStride:void 0,T=s.normalized===!0;let g,m;if(p&&p!==u){const y=Math.floor(f/p),L="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+y+":"+s.count;let w=n.cache.get(L);w||(g=new l(r,y*p,s.count*p/h),w=new Rn(g,p/h),n.cache.add(L,w)),m=new Wn(w,a,f%p/h,T)}else r===null?g=new l(s.count*a):g=new l(r,f,s.count*a),m=new me(g,a,T);if(s.sparse!==void 0){const y=ze.SCALAR,L=le[s.sparse.indices.componentType],w=s.sparse.indices.byteOffset||0,R=s.sparse.values.byteOffset||0,A=new L(i[1],w,s.sparse.count*y),I=new l(i[2],R,s.sparse.count*a);r!==null&&(m=new me(m.array.slice(),m.itemSize,m.normalized));for(let P=0,k=A.length;P<k;P++){const j=A[P];if(m.setX(j,I[P*a]),a>=2&&m.setY(j,I[P*a+1]),a>=3&&m.setZ(j,I[P*a+2]),a>=4&&m.setW(j,I[P*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return m})}loadTexture(t){const n=this.json,e=this.options,o=n.textures[t].source,i=n.images[o];let r=this.textureLoader;if(i.uri){const a=e.manager.getHandler(i.uri);a!==null&&(r=a)}return this.loadTextureImage(t,o,r)}loadTextureImage(t,n,e){const s=this,o=this.json,i=o.textures[t],r=o.images[n],a=(r.uri||r.bufferView)+":"+i.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(n,e).then(function(h){h.flipY=!1,h.name=i.name||r.name||"";const f=(o.samplers||{})[i.sampler]||{};return h.magFilter=_t[f.magFilter]||Dt,h.minFilter=_t[f.minFilter]||kt,h.wrapS=St[f.wrapS]||Ye,h.wrapT=St[f.wrapT]||Ye,s.associations.set(h,{textures:t}),h}).catch(function(){return null});return this.textureCache[a]=l,l}loadImageSource(t,n){const e=this,s=this.json,o=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(u=>u.clone());const i=s.images[t],r=self.URL||self.webkitURL;let a=i.uri||"",l=!1;if(i.bufferView!==void 0)a=e.getDependency("bufferView",i.bufferView).then(function(u){l=!0;const f=new Blob([u],{type:i.mimeType});return a=r.createObjectURL(f),a});else if(i.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const h=Promise.resolve(a).then(function(u){return new Promise(function(f,p){let T=f;n.isImageBitmapLoader===!0&&(T=function(g){const m=new Et(g);m.needsUpdate=!0,f(m)}),n.load(qe.resolveURL(u,o.path),T,void 0,p)})}).then(function(u){return l===!0&&r.revokeObjectURL(a),u.userData.mimeType=i.mimeType||js(i.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),u});return this.sourceCache[t]=h,h}assignTexture(t,n,e,s){const o=this;return this.getDependency("texture",e.index).then(function(i){if(!i)return null;if(e.texCoord!==void 0&&e.texCoord!=0&&!(n==="aoMap"&&e.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+e.texCoord+" for texture "+n+" not yet supported."),o.extensions[x.KHR_TEXTURE_TRANSFORM]){const r=e.extensions!==void 0?e.extensions[x.KHR_TEXTURE_TRANSFORM]:void 0;if(r){const a=o.associations.get(i);i=o.extensions[x.KHR_TEXTURE_TRANSFORM].extendTexture(i,r),o.associations.set(i,a)}}return s!==void 0&&(i.encoding=s),t[n]=i,i})}assignFinalMaterial(t){const n=t.geometry;let e=t.material;const s=n.attributes.tangent===void 0,o=n.attributes.color!==void 0,i=n.attributes.normal===void 0;if(t.isPoints){const r="PointsMaterial:"+e.uuid;let a=this.cache.get(r);a||(a=new _n,Ge.prototype.copy.call(a,e),a.color.copy(e.color),a.map=e.map,a.sizeAttenuation=!1,this.cache.add(r,a)),e=a}else if(t.isLine){const r="LineBasicMaterial:"+e.uuid;let a=this.cache.get(r);a||(a=new Sn,Ge.prototype.copy.call(a,e),a.color.copy(e.color),this.cache.add(r,a)),e=a}if(s||o||i){let r="ClonedMaterial:"+e.uuid+":";s&&(r+="derivative-tangents:"),o&&(r+="vertex-colors:"),i&&(r+="flat-shading:");let a=this.cache.get(r);a||(a=e.clone(),o&&(a.vertexColors=!0),i&&(a.flatShading=!0),s&&(a.normalScale&&(a.normalScale.y*=-1),a.clearcoatNormalScale&&(a.clearcoatNormalScale.y*=-1)),this.cache.add(r,a),this.associations.set(a,this.associations.get(e))),e=a}e.aoMap&&n.attributes.uv2===void 0&&n.attributes.uv!==void 0&&n.setAttribute("uv2",n.attributes.uv),t.material=e}getMaterialType(){return Ie}loadMaterial(t){const n=this,e=this.json,s=this.extensions,o=e.materials[t];let i;const r={},a=o.extensions||{},l=[];if(a[x.KHR_MATERIALS_UNLIT]){const u=s[x.KHR_MATERIALS_UNLIT];i=u.getMaterialType(),l.push(u.extendParams(r,o,n))}else{const u=o.pbrMetallicRoughness||{};if(r.color=new J(1,1,1),r.opacity=1,Array.isArray(u.baseColorFactor)){const f=u.baseColorFactor;r.color.fromArray(f),r.opacity=f[3]}u.baseColorTexture!==void 0&&l.push(n.assignTexture(r,"map",u.baseColorTexture,ue)),r.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,r.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(l.push(n.assignTexture(r,"metalnessMap",u.metallicRoughnessTexture)),l.push(n.assignTexture(r,"roughnessMap",u.metallicRoughnessTexture))),i=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(t)}),l.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(t,r)})))}o.doubleSided===!0&&(r.side=Mn);const h=o.alphaMode||Ve.OPAQUE;if(h===Ve.BLEND?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,h===Ve.MASK&&(r.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&i!==ee&&(l.push(n.assignTexture(r,"normalMap",o.normalTexture)),r.normalScale=new N(1,1),o.normalTexture.scale!==void 0)){const u=o.normalTexture.scale;r.normalScale.set(u,u)}return o.occlusionTexture!==void 0&&i!==ee&&(l.push(n.assignTexture(r,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(r.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&i!==ee&&(r.emissive=new J().fromArray(o.emissiveFactor)),o.emissiveTexture!==void 0&&i!==ee&&l.push(n.assignTexture(r,"emissiveMap",o.emissiveTexture,ue)),Promise.all(l).then(function(){const u=new i(r);return o.name&&(u.name=o.name),Y(u,o),n.associations.set(u,{materials:t}),o.extensions&&he(s,u,o),u})}createUniqueName(t){const n=On.sanitizeNodeName(t||"");let e=n;for(let s=1;this.nodeNamesUsed[e];++s)e=n+"_"+s;return this.nodeNamesUsed[e]=!0,e}loadGeometries(t){const n=this,e=this.extensions,s=this.primitiveCache;function o(r){return e[x.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(r,n).then(function(a){return Ot(a,r,n)})}const i=[];for(let r=0,a=t.length;r<a;r++){const l=t[r],h=Hs(l),u=s[h];if(u)i.push(u.promise);else{let f;l.extensions&&l.extensions[x.KHR_DRACO_MESH_COMPRESSION]?f=o(l):f=Ot(new Ft,l,n),s[h]={primitive:l,promise:f},i.push(f)}}return Promise.all(i)}loadMesh(t){const n=this,e=this.json,s=this.extensions,o=e.meshes[t],i=o.primitives,r=[];for(let a=0,l=i.length;a<l;a++){const h=i[a].material===void 0?Ds(this.cache):this.getDependency("material",i[a].material);r.push(h)}return r.push(n.loadGeometries(i)),Promise.all(r).then(function(a){const l=a.slice(0,a.length-1),h=a[a.length-1],u=[];for(let p=0,T=h.length;p<T;p++){const g=h[p],m=i[p];let y;const L=l[p];if(m.mode===v.TRIANGLES||m.mode===v.TRIANGLE_STRIP||m.mode===v.TRIANGLE_FAN||m.mode===void 0)y=o.isSkinnedMesh===!0?new In(g,L):new Pe(g,L),y.isSkinnedMesh===!0&&!y.geometry.attributes.skinWeight.normalized&&y.normalizeSkinWeights(),m.mode===v.TRIANGLE_STRIP?y.geometry=Lt(y.geometry,Nt):m.mode===v.TRIANGLE_FAN&&(y.geometry=Lt(y.geometry,Xe));else if(m.mode===v.LINES)y=new Pn(g,L);else if(m.mode===v.LINE_STRIP)y=new Nn(g,L);else if(m.mode===v.LINE_LOOP)y=new Cn(g,L);else if(m.mode===v.POINTS)y=new Dn(g,L);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);Object.keys(y.geometry.morphAttributes).length>0&&Fs(y,o),y.name=n.createUniqueName(o.name||"mesh_"+t),Y(y,o),m.extensions&&he(s,y,m),n.assignFinalMaterial(y),u.push(y)}for(let p=0,T=u.length;p<T;p++)n.associations.set(u[p],{meshes:t,primitives:p});if(u.length===1)return u[0];const f=new Be;n.associations.set(f,{meshes:t});for(let p=0,T=u.length;p<T;p++)f.add(u[p]);return f})}loadCamera(t){let n;const e=this.json.cameras[t],s=e[e.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return e.type==="perspective"?n=new Ht(kn.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):e.type==="orthographic"&&(n=new Fn(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),e.name&&(n.name=this.createUniqueName(e.name)),Y(n,e),Promise.resolve(n)}loadSkin(t){const n=this.json.skins[t],e=[];for(let s=0,o=n.joints.length;s<o;s++)e.push(this.getDependency("node",n.joints[s]));return n.inverseBindMatrices!==void 0?e.push(this.getDependency("accessor",n.inverseBindMatrices)):e.push(null),Promise.all(e).then(function(s){const o=s.pop(),i=s,r=[],a=[];for(let l=0,h=i.length;l<h;l++){const u=i[l];if(u){r.push(u);const f=new Ne;o!==null&&f.fromArray(o.array,l*16),a.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[l])}return new Hn(r,a)})}loadAnimation(t){const e=this.json.animations[t],s=[],o=[],i=[],r=[],a=[];for(let l=0,h=e.channels.length;l<h;l++){const u=e.channels[l],f=e.samplers[u.sampler],p=u.target,T=p.node,g=e.parameters!==void 0?e.parameters[f.input]:f.input,m=e.parameters!==void 0?e.parameters[f.output]:f.output;s.push(this.getDependency("node",T)),o.push(this.getDependency("accessor",g)),i.push(this.getDependency("accessor",m)),r.push(f),a.push(p)}return Promise.all([Promise.all(s),Promise.all(o),Promise.all(i),Promise.all(r),Promise.all(a)]).then(function(l){const h=l[0],u=l[1],f=l[2],p=l[3],T=l[4],g=[];for(let y=0,L=h.length;y<L;y++){const w=h[y],R=u[y],A=f[y],I=p[y],P=T[y];if(w===void 0)continue;w.updateMatrix();let k;switch(q[P.path]){case q.weights:k=qn;break;case q.rotation:k=At;break;case q.position:case q.scale:default:k=Xn;break}const j=w.name?w.name:w.uuid,ie=I.interpolation!==void 0?Cs[I.interpolation]:jt,$=[];q[P.path]===q.weights?w.traverse(function(M){M.morphTargetInfluences&&$.push(M.name?M.name:M.uuid)}):$.push(j);let z=A.array;if(A.normalized){const M=Je(z.constructor),X=new Float32Array(z.length);for(let G=0,de=z.length;G<de;G++)X[G]=z[G]*M;z=X}for(let M=0,X=$.length;M<X;M++){const G=new k($[M]+"."+q[P.path],R.array,z,ie);I.interpolation==="CUBICSPLINE"&&(G.createInterpolant=function(He){const be=this instanceof At?Ns:Bt;return new be(this.times,this.values,this.getValueSize()/3,He)},G.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),g.push(G)}}const m=e.name?e.name:"animation_"+t;return new vt(m,void 0,g)})}createNodeMesh(t){const n=this.json,e=this,s=n.nodes[t];return s.mesh===void 0?null:e.getDependency("mesh",s.mesh).then(function(o){const i=e._getNodeRef(e.meshCache,s.mesh,o);return s.weights!==void 0&&i.traverse(function(r){if(r.isMesh)for(let a=0,l=s.weights.length;a<l;a++)r.morphTargetInfluences[a]=s.weights[a]}),i})}loadNode(t){const n=this.json,e=this.extensions,s=this,o=n.nodes[t],i=o.name?s.createUniqueName(o.name):"";return function(){const r=[],a=s._invokeOne(function(f){return f.createNodeMesh&&f.createNodeMesh(t)});a&&r.push(a),o.camera!==void 0&&r.push(s.getDependency("camera",o.camera).then(function(f){return s._getNodeRef(s.cameraCache,o.camera,f)})),s._invokeAll(function(f){return f.createNodeAttachment&&f.createNodeAttachment(t)}).forEach(function(f){r.push(f)});const l=[],h=o.children||[];for(let f=0,p=h.length;f<p;f++)l.push(s.getDependency("node",h[f]));const u=o.skin===void 0?Promise.resolve(null):s.getDependency("skin",o.skin);return Promise.all([Promise.all(r),Promise.all(l),u])}().then(function(r){const a=r[0],l=r[1],h=r[2];let u;if(o.isBone===!0?u=new jn:a.length>1?u=new Be:a.length===1?u=a[0]:u=new Ct,u!==a[0])for(let f=0,p=a.length;f<p;f++)u.add(a[f]);if(o.name&&(u.userData.name=o.name,u.name=i),Y(u,o),o.extensions&&he(e,u,o),o.matrix!==void 0){const f=new Ne;f.fromArray(o.matrix),u.applyMatrix4(f)}else o.translation!==void 0&&u.position.fromArray(o.translation),o.rotation!==void 0&&u.quaternion.fromArray(o.rotation),o.scale!==void 0&&u.scale.fromArray(o.scale);s.associations.has(u)||s.associations.set(u,{}),s.associations.get(u).nodes=t,h!==null&&u.traverse(function(f){f.isSkinnedMesh&&f.bind(h,vs)});for(let f=0,p=l.length;f<p;f++)u.add(l[f]);return u})}loadScene(t){const n=this.extensions,e=this.json.scenes[t],s=this,o=new Be;e.name&&(o.name=s.createUniqueName(e.name)),Y(o,e),e.extensions&&he(n,o,e);const i=e.nodes||[],r=[];for(let a=0,l=i.length;a<l;a++)r.push(s.getDependency("node",i[a]));return Promise.all(r).then(function(a){for(let h=0,u=a.length;h<u;h++)o.add(a[h]);const l=h=>{const u=new Map;for(const[f,p]of s.associations)(f instanceof Ge||f instanceof Et)&&u.set(f,p);return h.traverse(f=>{const p=s.associations.get(f);p!=null&&u.set(f,p)}),u};return s.associations=l(o),o})}}function Gs(c,t,n){const e=t.attributes,s=new Yn;if(e.POSITION!==void 0){const r=n.json.accessors[e.POSITION],a=r.min,l=r.max;if(a!==void 0&&l!==void 0){if(s.set(new C(a[0],a[1],a[2]),new C(l[0],l[1],l[2])),r.normalized){const h=Je(le[r.componentType]);s.min.multiplyScalar(h),s.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=t.targets;if(o!==void 0){const r=new C,a=new C;for(let l=0,h=o.length;l<h;l++){const u=o[l];if(u.POSITION!==void 0){const f=n.json.accessors[u.POSITION],p=f.min,T=f.max;if(p!==void 0&&T!==void 0){if(a.setX(Math.max(Math.abs(p[0]),Math.abs(T[0]))),a.setY(Math.max(Math.abs(p[1]),Math.abs(T[1]))),a.setZ(Math.max(Math.abs(p[2]),Math.abs(T[2]))),f.normalized){const g=Je(le[f.componentType]);a.multiplyScalar(g)}r.max(a)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(r)}c.boundingBox=s;const i=new Zn;s.getCenter(i.center),i.radius=s.min.distanceTo(s.max)/2,c.boundingSphere=i}function Ot(c,t,n){const e=t.attributes,s=[];function o(i,r){return n.getDependency("accessor",i).then(function(a){c.setAttribute(r,a)})}for(const i in e){const r=Qe[i]||i.toLowerCase();r in c.attributes||s.push(o(e[i],r))}if(t.indices!==void 0&&!c.index){const i=n.getDependency("accessor",t.indices).then(function(r){c.setIndex(r)});s.push(i)}return Y(c,t),Gs(c,t,n),Promise.all(s).then(function(){return t.targets!==void 0?ks(c,t.targets,n):c})}const We=new WeakMap;class Bs extends tt{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,n,e,s){const o=new Te(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,i=>{this.decodeDracoFile(i,n).catch(s)},e,s)}decodeDracoFile(t,n,e,s){const o={attributeIDs:e||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!e};return this.decodeGeometry(t,o).then(n)}decodeGeometry(t,n){const e=JSON.stringify(n);if(We.has(t)){const a=We.get(t);if(a.key===e)return a.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const o=this.workerNextTaskID++,i=t.byteLength,r=this._getWorker(o,i).then(a=>(s=a,new Promise((l,h)=>{s._callbacks[o]={resolve:l,reject:h},s.postMessage({type:"decode",id:o,taskConfig:n,buffer:t},[t])}))).then(a=>this._createGeometry(a.geometry));return r.catch(()=>!0).then(()=>{s&&o&&this._releaseTask(s,o)}),We.set(t,{key:e,promise:r}),r}_createGeometry(t){const n=new Ft;t.index&&n.setIndex(new me(t.index.array,1));for(let e=0;e<t.attributes.length;e++){const s=t.attributes[e],o=s.name,i=s.array,r=s.itemSize;n.setAttribute(o,new me(i,r))}return n}_loadLibrary(t,n){const e=new Te(this.manager);return e.setPath(this.decoderPath),e.setResponseType(n),e.setWithCredentials(this.withCredentials),new Promise((s,o)=>{e.load(t,s,void 0,o)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",n=[];return t?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then(e=>{const s=e[0];t||(this.decoderConfig.wasmBinary=e[1]);const o=Ks.toString(),i=["/* draco decoder */",s,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([i]))}),this.decoderPending}_getWorker(t,n){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(o){const i=o.data;switch(i.type){case"decode":s._callbacks[i.id].resolve(i);break;case"error":s._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,o){return s._taskLoad>o._taskLoad?-1:1});const e=this.workerPool[this.workerPool.length-1];return e._taskCosts[t]=n,e._taskLoad+=n,e})}_releaseTask(t,n){t._taskLoad-=t._taskCosts[n],delete t._callbacks[n],delete t._taskCosts[n]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function Ks(){let c,t;onmessage=function(i){const r=i.data;switch(r.type){case"init":c=r.decoderConfig,t=new Promise(function(h){c.onModuleLoaded=function(u){h({draco:u})},DracoDecoderModule(c)});break;case"decode":const a=r.buffer,l=r.taskConfig;t.then(h=>{const u=h.draco,f=new u.Decoder,p=new u.DecoderBuffer;p.Init(new Int8Array(a),a.byteLength);try{const T=n(u,f,p,l),g=T.attributes.map(m=>m.array.buffer);T.index&&g.push(T.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:T},g)}catch(T){console.error(T),self.postMessage({type:"error",id:r.id,error:T.message})}finally{u.destroy(p),u.destroy(f)}});break}};function n(i,r,a,l){const h=l.attributeIDs,u=l.attributeTypes;let f,p;const T=r.GetEncodedGeometryType(a);if(T===i.TRIANGULAR_MESH)f=new i.Mesh,p=r.DecodeBufferToMesh(a,f);else if(T===i.POINT_CLOUD)f=new i.PointCloud,p=r.DecodeBufferToPointCloud(a,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!p.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+p.error_msg());const g={index:null,attributes:[]};for(const m in h){const y=self[u[m]];let L,w;if(l.useUniqueIDs)w=h[m],L=r.GetAttributeByUniqueId(f,w);else{if(w=r.GetAttributeId(f,i[h[m]]),w===-1)continue;L=r.GetAttribute(f,w)}g.attributes.push(s(i,r,f,m,y,L))}return T===i.TRIANGULAR_MESH&&(g.index=e(i,r,f)),i.destroy(f),g}function e(i,r,a){const h=a.num_faces()*3,u=h*4,f=i._malloc(u);r.GetTrianglesUInt32Array(a,u,f);const p=new Uint32Array(i.HEAPF32.buffer,f,h).slice();return i._free(f),{array:p,itemSize:1}}function s(i,r,a,l,h,u){const f=u.num_components(),T=a.num_points()*f,g=T*h.BYTES_PER_ELEMENT,m=o(i,h),y=i._malloc(g);r.GetAttributeDataArrayForAllPoints(a,u,m,g,y);const L=new h(i.HEAPF32.buffer,y,T).slice();return i._free(y),{name:l,array:L,itemSize:f}}function o(i,r){switch(r){case Float32Array:return i.DT_FLOAT32;case Int8Array:return i.DT_INT8;case Int16Array:return i.DT_INT16;case Int32Array:return i.DT_INT32;case Uint8Array:return i.DT_UINT8;case Uint16Array:return i.DT_UINT16;case Uint32Array:return i.DT_UINT32}}}class zs extends tt{constructor(t){super(t)}load(t,n,e,s){const o=this,i=new Te(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(t,function(r){const a=o.parse(JSON.parse(r));n&&n(a)},e,s)}parse(t){return new Vs(t)}}class Vs{constructor(t){this.isFont=!0,this.type="Font",this.data=t}generateShapes(t,n=100){const e=[],s=Ws(t,n,this.data);for(let o=0,i=s.length;o<i;o++)e.push(...s[o].toShapes());return e}}function Ws(c,t,n){const e=Array.from(c),s=t/n.resolution,o=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*s,i=[];let r=0,a=0;for(let l=0;l<e.length;l++){const h=e[l];if(h===`
`)r=0,a-=o;else{const u=Xs(h,s,r,a,n);r+=u.offsetX,i.push(u.path)}}return i}function Xs(c,t,n,e,s){const o=s.glyphs[c]||s.glyphs["?"];if(!o){console.error('THREE.Font: character "'+c+'" does not exists in font family '+s.familyName+".");return}const i=new Jn;let r,a,l,h,u,f,p,T;if(o.o){const g=o._cachedOutline||(o._cachedOutline=o.o.split(" "));for(let m=0,y=g.length;m<y;)switch(g[m++]){case"m":r=g[m++]*t+n,a=g[m++]*t+e,i.moveTo(r,a);break;case"l":r=g[m++]*t+n,a=g[m++]*t+e,i.lineTo(r,a);break;case"q":l=g[m++]*t+n,h=g[m++]*t+e,u=g[m++]*t+n,f=g[m++]*t+e,i.quadraticCurveTo(u,f,l,h);break;case"b":l=g[m++]*t+n,h=g[m++]*t+e,u=g[m++]*t+n,f=g[m++]*t+e,p=g[m++]*t+n,T=g[m++]*t+e,i.bezierCurveTo(u,f,p,T,l,h);break}}return{offsetX:o.ha*t,path:i}}class It extends $n{constructor(t,n={}){const e=n.font;if(e===void 0)super();else{const s=e.generateShapes(t,n.size);n.depth=n.height!==void 0?n.height:50,n.bevelThickness===void 0&&(n.bevelThickness=10),n.bevelSize===void 0&&(n.bevelSize=8),n.bevelEnabled===void 0&&(n.bevelEnabled=!1),super(s,n)}this.type="TextGeometry"}}const _={ROOM:"room",BOOK_CV:"Book",BOOK1:"Book001",BOOK:"open_book",STAND:"Stand",SWITCH_BOARD:"SwitchBoard",SWITCH:"Switch",DRAGON:"dragon",CAMERA_TRIPOD:"camera_tripod",OFFICE_CHAIR:"office_chair",CPU:"CPU",WALL:"Wall",DRONE:"drone",FLAG:"BG_flag",APPLE:"apple",SPEAKER:"speaker",BALL:"ball",GIN:"gin"},Re={BOOK:{OPEN:"Animation"},DRONE:{HOVER:"hover"},FLAG:{MOVE:"Object_0"},DRAGON:{IDLE:"metarig|idol"}};let ge="light",ye=null,$e=null,Z=null,Q=null;const et=new Map;let we=null,_e,K,xe=!1,Le=!1,qs=window.matchMedia("(max-width: 992px)").matches,Ys=document.querySelector(".experience-canvas");const Zs=document.getElementById("loader-wrapper");let te=[{image:"textures/project-colorpop.jpg",url:"https://github.com/Copelli-Yoshovski-Associates/ColorPop_AI_Project"},{image:"textures/project-java-app.jpg",url:"https://github.com/yoshovski/store-management-software-unical"},{image:"textures/project-siliconsquare.jpg",url:"https://github.com/Silicon-Square/SiliconSquare"},{image:"textures/project-sorting.jpg",url:"https://github.com/Copelli-Yoshovski-Associates/Parallel-Sorting-Algorithms-MPI"},{image:"textures/project-thesis.jpg",url:"https://github.com/yoshovski/Thesis-ASP-Based-System-For-Humanitarian-Assistance"},{image:"textures/project-wordpress-plugin.jpg",url:"https://github.com/yoshovski/world-domi-map"}],Kt={x:.12,y:.2,z:.55},zt={x:-1.54,y:.13,z:1.41},Vt={x:1,y:.45,z:.01},Wt={x:.05,y:.05,z:0};const F=new es,H=new Ht(75,window.innerWidth/window.innerHeight,.01,1e3);let Se={x:5.6,y:.5463638814987481,z:.8},Qs={x:-.8313297556598935,y:.9383399492446749,z:.7240714481613063};H.position.set(Se.x,Se.y,Se.z);const oe=new ts({canvas:Ys,antialias:!0});oe.setSize(window.innerWidth,window.innerHeight);oe.setPixelRatio(window.devicePixelRatio);oe.shadowMap.enabled=!0;oe.shadowMap.type=ns;const U=new us(H,oe.domElement);U.enablePan=!1;U.minDistance=.9;U.maxDistance=1.6;U.minAzimuthAngle=.2;U.maxAzimuthAngle=Math.PI*.78;U.minPolarAngle=.3;U.maxPolarAngle=Math.PI/2;U.update();const Js=[_.DRAGON,_.CAMERA_TRIPOD,_.OFFICE_CHAIR,_.APPLE,_.SPEAKER,_.BALL,_.GIN,_.DRONE,_.BOOK,_.FLAG],Xt=new Bs;Xt.setDecoderPath("lib/draco/");const qt=new ds;qt.setDRACOLoader(Xt);qt.load("models/room/room.glb",function(c){_e=c,Zs.style.display="none",K=document.createElement("video"),K.src="textures/drone.mp4",K.muted=!0,K.playsInline=!0,K.autoplay=!0,K.loop=!0;const t=new ss(K);t.minFilter=Ze,t.magFilter=Ze,t.generateMipmaps=!1,t.encoding=ue,c.scene=c.scene.children[0],c.scene.children.forEach(n=>{if(sn(n),n.name!==_.WALL&&(n.castShadow=!0),n.receiveShadow=!0,n.children&&n.children.forEach(e=>{e.name!==_.BOOK1&&e.name!==_.SWITCH&&(e.castShadow=!0),e.receiveShadow=!0}),n.name===_.STAND&&(n.children[0].material=new ee({map:t}),K.play()),n.name===_.BOOK_CV){ye=n.children[0];const e=new nt().load("textures/book-inner.jpg");e.flipY=!1,n.material=new Ie({color:16777215,map:e})}n.name===_.SWITCH_BOARD&&($e=n.children[0]),n.name===_.APPLE&&n.material instanceof Ie&&(n.material.emissive=new J(16711680),n.material.emissiveIntensity=.4,n.material.needsUpdate=!0),Js.includes(n.name)&&nn(n),Me(c,_.DRAGON,Re.DRAGON.IDLE)}),F.add(c.scene),Yt(),eo(),oo(),io(),ro(),ao(),co(c.scene)},function(c){console.error(c)});const pe=new os(16777215,.6);F.add(pe);const D=new ne(16777215,2.5,10);D.position.set(.3,2,.5);D.castShadow=!0;D.shadow.radius=5;D.shadow.mapSize.width=2048;D.shadow.mapSize.height=2048;D.shadow.camera.far=2.5;D.shadow.bias=-.002;F.add(D);const Pt=new ne(65280,30,.05),Ce=new ne(16711680,0,1.1),De=new ne(16711680,0,1.1),ke=new ne(16711680,0,1.1),Fe=new ne(16711680,0,1.1);Ce.position.set(-.2,.6,.24);De.position.set(-.2,.6,.42);ke.position.set(-.2,.6,.01);Fe.position.set(-.2,.6,-.14);F.add(Ce);F.add(De);F.add(ke);F.add(Fe);const $s=new ls;function Yt(){requestAnimationFrame(Yt);const c=$s.getDelta();et.forEach(t=>t.update(c)),oe.render(F,H)}function eo(){const c=new zs;c.load("fonts/unione.json",function(t){const n=[new Ae({color:1515303,flatShading:!0}),new Ae({color:16777215})],e=new It("STEFKO YOSHOVSKI",{font:t,size:.08,height:.01});Z=new Pe(e,n),Z.rotation.y=Math.PI*.5,Z.position.set(-.27,.55,.5),F.add(Z)}),c.load("fonts/helvatica.json",function(t){const n=[new Ae({color:1515303,flatShading:!0}),new Ae({color:16777215})],e=new It("Videomaker / Developer / Photographer",{font:t,size:.018,height:0});Q=new Pe(e,n),Q.rotation.y=Math.PI*.5,Q.position.set(-.255,.5,.5),F.add(Q)})}function to(c){c==="dark"?($e.rotation.z=Math.PI/7,document.body.classList.remove("light-theme"),document.body.classList.add("dark-theme"),E.to(D.color,{r:.2725490196078431,g:.23137254901960785,b:.6862745098039216}),E.to(pe.color,{r:.17254901960784313,g:.23137254901960785,b:.6862745098039216}),E.to(D,{intensity:1.5}),E.to(pe,{intensity:.3}),E.to(Pt,{distance:.07}),E.to(Z.material[0].color,{r:8,g:8,b:8,duration:0}),E.to(Z.material[1].color,{r:5,g:5,b:5,duration:0}),E.to(Q.material[0].color,{r:8,g:8,b:8,duration:0}),E.to(Q.material[1].color,{r:5,g:5,b:5,duration:0}),E.to(Ce,{intensity:.6}),E.to(De,{intensity:.6}),E.to(ke,{intensity:.6}),E.to(Fe,{intensity:.6})):($e.rotation.z=0,document.body.classList.remove("dark-theme"),document.body.classList.add("light-theme"),E.to(D.color,{r:1,g:1,b:1}),E.to(pe.color,{r:1,g:1,b:1}),E.to(D,{intensity:2.5}),E.to(pe,{intensity:.6}),E.to(Pt,{distance:.05}),E.to(Z.material[0].color,{r:.09019607843137255,g:.12156862745098039,b:.15294117647058825,duration:0}),E.to(Z.material[1].color,{r:1,g:1,b:1,duration:0}),E.to(Q.material[0].color,{r:.09019607843137255,g:.12156862745098039,b:.15294117647058825,duration:0}),E.to(Q.material[1].color,{r:1,g:1,b:1,duration:0}),E.to(Ce,{intensity:0}),E.to(De,{intensity:0}),E.to(ke,{intensity:0}),E.to(Fe,{intensity:0}))}function no(){U.enabled=!0}function st(){U.enabled=!1}function ot(){document.getElementById("close-btn").style.display="block"}function so(){document.getElementById("close-btn").style.display="none"}function Zt(){ye&&E.to(ye.rotation,{x:0,duration:1.5})}function Qt(){te.length!==0&&te.forEach((c,t)=>{E.to(c.mesh.material,{opacity:0,duration:1}),E.to(c.mesh.position,{y:c.y,duration:1}),E.to(c.mesh.scale,{x:0,y:0,z:0,duration:0,delay:1})})}function Jt(){Zt(),Qt(),so(),E.to(H.position,{...Se,duration:1.5}),E.to(H.rotation,{...Qs,duration:1.5}),E.delayedCall(1.5,no),ge!=="dark"&&E.to(D,{intensity:2.5,duration:1.5})}function oo(){document.getElementById("logo").addEventListener("click",function(c){c.preventDefault(),Jt()})}function $t(){ye&&(E.to(H.position,{...Kt,duration:1.5}),E.to(H.rotation,{...zt,duration:1.5}),E.to(ye.rotation,{x:Math.PI,duration:1.5,delay:1.5}),ge!=="dark"&&E.to(D,{intensity:1,duration:1.5}))}function io(){document.getElementById("about-menu").addEventListener("click",function(c){c.preventDefault(),st(),Qt(),$t(),E.delayedCall(1.5,ot)})}function ro(){te.forEach((c,t)=>{const n=t%3,e=Math.floor(t/3),s=new is(.71,.4),o=new ee({color:16777215,map:new nt().load(c.image),transparent:!0,opacity:0}),i=new Pe(s,o);i.name="project",i.userData={url:c.url},i.position.set(.3+n*.8,1-e*.5,-1.15),i.scale.set(0,0,0),te[t].mesh=i,te[t].y=1-e*.5,F.add(i)}),document.getElementById("projects-menu").addEventListener("click",function(c){c.preventDefault(),st(),Zt(),E.to(H.position,{...Vt,duration:1.5}),E.to(H.rotation,{...Wt,duration:1.5}),E.delayedCall(1.5,ot),te.forEach((t,n)=>{t.mesh.scale.set(1,1,1),E.to(t.mesh.material,{opacity:1,duration:1.5,delay:1.5+n*.1}),E.to(t.mesh.position,{y:t.y+.05,duration:1,delay:1.5+n*.1})})})}function ao(){const c=new N,t=new Ut;let n;window.addEventListener("click",function(e){if(Le)return;Le=!0;const s=ge==="light"?"dark":"light",o=document.getElementById("close-btn"),i=document.getElementById("projects-menu");if(e.target===o||o.contains(e.target)||e.target===i||i.contains(e.target))return Le=!1,!1;if(c.x=e.clientX/window.innerWidth*2-1,c.y=-(e.clientY/window.innerHeight)*2+1,t.setFromCamera(c,H),n=t.intersectObjects(F.children),n.length>0){const r=n[0],a=en(r.object);r.object.name==="project"&&r.object.userData.url&&window.open(r.object.userData.url),(r.object.name===_.BOOK_CV||r.object.name===_.BOOK1)&&(st(),$t(),E.delayedCall(1.5,ot)),(r.object.name===_.SWITCH_BOARD||r.object.name===_.SWITCH)&&(ge=s,to(ge)),a.name===_.SPEAKER&&(console.log("Speaker clicked"),K?(xe=!xe,K.muted=!xe,console.log(`Audio is now ${xe?"on":"off"}`)):console.error("Video element not found"))}setTimeout(()=>{Le=!1,console.log("Click processing reset.")},100)})}function co(c){qs&&(c.scale.set(.95,.95,.95),Kt={x:.09,y:.23,z:.51},zt={x:-1.57,y:0,z:1.57},Vt={x:1.1,y:.82,z:.5},Wt={x:0,y:0,z:1.55},te.forEach((t,n)=>{t.mesh.position.z=-1.13}),U.maxDistance=1.5,U.maxAzimuthAngle=Math.PI*.75)}document.getElementById("close-btn").addEventListener("click",c=>{c.preventDefault(),Jt()});document.getElementById("contact-btn").addEventListener("click",c=>{c.preventDefault(),document.querySelector(".contact-menu__dropdown").classList.toggle("contact-menu__dropdown--open")});document.addEventListener("mouseup",c=>{const t=document.querySelector(".contact-menu");t.contains(c.target)||t.querySelector(".contact-menu__dropdown").classList.remove("contact-menu__dropdown--open")});window.addEventListener("resize",()=>{H.aspect=window.innerWidth/window.innerHeight,H.updateProjectionMatrix(),oe.setSize(window.innerWidth,window.innerHeight)});function Me(c,t,n,e=!0){const s=tn(c.scene,t);if(s.name===t){console.log("object found: ",s);const o=c.animations.map(a=>a.name);console.log("Available Animations: ",o);let i=et.get(t);i||(i=new rs(s),et.set(t,i));const r=vt.findByName(c.animations,n);if(r){const a=i.clipAction(r);a.reset(),a.play(),e?a.setLoop(as):(a.setLoop(cs),a.clampWhenFinished=!0),console.log("Animation clip is playing"),s.userData.mixer=i}else console.error("Animation clip not found")}}function en(c){for(;c.parent&&c.parent.name!==_.ROOM;)c=c.parent;return c}function lo(c){const t=new N,n=new Ut;t.x=c.clientX/window.innerWidth*2-1,t.y=-(c.clientY/window.innerHeight)*2+1,n.setFromCamera(t,H);const e=n.intersectObjects(F.children,!0);if(e.length>0){const s=e[0].object,o=en(s);console.log("Hovered object:",o.name),o.name===_.DRONE?we!==o&&(we=o,Me(_e,_.DRONE,Re.DRONE.HOVER),Me(_e,_.FLAG,Re.FLAG.MOVE),Me(_e,_.BOOK,Re.BOOK.OPEN,!1)):we=null}else we=null}window.addEventListener("mousemove",lo);function tn(c,t){if(c.name===t)return c;for(let n=0;n<c.children.length;n++){const e=c.children[n],s=tn(e,t);if(s)return s}return null}function nn(c){c.castShadow=!0,c.receiveShadow=!0,c.children.forEach(t=>nn(t))}function sn(c){c.material&&console.log(`Object: ${c.name}, Material:`,c.material),c.children.forEach(t=>sn(t))}
